app-id: org.openttd.OpenTTD
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: openttd
rename-icon: openttd
rename-desktop-file: openttd.desktop
finish-args:
  - --device=dri
  - --filesystem=home
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --socket=fallback-x11
  - --socket=wayland
modules:
  - name: SDL2
    buildsystem: autotools
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://www.libsdl.org/release/SDL2-2.0.16.tar.gz
        sha256: 65be9ff6004034b5b2ce9927b5a4db1814930f169c4b2dae0a1e4697075f287b
        x-checker-data:
          type: anitya
          project-id: 4779
          stable-only: true
          url-template: https://www.libsdl.org/release/SDL2-$version.tar.gz
    modules:
      - name: libdecor
        config-opts:
          - -Ddemo=false
        buildsystem: meson
        cleanup:
          - /include
          - /lib/pkgconfig
        sources:
          - type: archive
            url: https://gitlab.gnome.org/jadahl/libdecor/uploads/81adf91d27620e20bcc5f6b9b312d768/libdecor-0.1.0.tar.xz
            sha256: fdefa11de4bd51cb14223a97e41fdd848f01f5c5ddca9b036a0c4e3e74d9f486

  - name: fluidsynth
    buildsystem: cmake
    config-opts:
      - -DLIB_INSTALL_DIR:STRING=lib
      - -DDEFAULT_SOUNDFONT:FILEPATH=/app/share/sounds/sf3/default-GM.sf3
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://github.com/FluidSynth/fluidsynth/archive/v2.2.3.tar.gz
        sha256: b31807cb0f88e97f3096e2b378c9815a6acfdc20b0b14f97936d905b536965c4
        x-checker-data:
          type: anitya
          project-id: 10437
          stable-only: true
          url-template: https://github.com/FluidSynth/fluidsynth/archive/v$version.tar.gz

  - name: musescore-general-soundfont
    buildsystem: simple
    build-commands:
      - install -D -m 644 -t $FLATPAK_DEST/share/sounds/sf3 MuseScore_General.sf3
      - ln -s $FLATPAK_DEST/share/sounds/sf3/{MuseScore_General,default-GM}.sf3
    sources:
      - type: file
        url: https://ftp.osuosl.org/pub/musescore/soundfont/MuseScore_General/MuseScore_General.sf3
        sha256: 5b85b6c2c61d10b2b91cddd41efcce7b25cd31c8271d511c73afafbef20b6fa3

  - name: lzo
    config-opts:
      - --enable-shared
      - --disable-static
    cleanup:
      - /include
      - /lib/*.la
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://www.oberhumer.com/opensource/lzo/download/lzo-2.10.tar.gz
        sha256: c0f892943208266f9b6543b3ae308fab6284c5c90e627931446fb49b4221a072
        x-checker-data:
          type: anitya
          project-id: 1868
          stable-only: true
          url-template: https://www.oberhumer.com/opensource/lzo/download/lzo-$version.tar.gz

  - name: openttd
    config-opts:
      - -DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo
      - -DCMAKE_INSTALL_BINDIR:STRING=bin
    buildsystem: cmake-ninja
    builddir: true
    post-install:
      - install -D -m 644 -t $FLATPAK_DEST/share/icons/hicolor/scalable/apps ../media/openttd.svg
      - install -D -m 644 -t $FLATPAK_DEST/share/metainfo ../org.openttd.OpenTTD.metainfo.xml
    sources:
      - type: archive
        url: https://cdn.openttd.org/openttd-releases/12.0/openttd-12.0-source.tar.xz
        sha256: bba0fd3800df0370259e642d251f362c7c00b478a2e3531f6ba7f84c1c2b32dc
        x-checker-data:
          type: anitya
          project-id: 8640
          stable-only: true
          url-template: https://cdn.openttd.org/openttd-releases/$version/openttd-$version-source.tar.xz
          is-main-source: true
      - type: file
        path: org.openttd.OpenTTD.metainfo.xml

  - name: openttd-opengfx
    buildsystem: simple
    build-commands:
      - tar -x -f opengfx-*.tar && rm opengfx-*.tar
      - mv opengfx-* $FLATPAK_DEST/share/games/openttd/baseset/opengfx
    sources:
      - type: archive
        url: https://cdn.openttd.org/opengfx-releases/7.1/opengfx-7.1-all.zip
        sha256: 928fcf34efd0719a3560cbab6821d71ce686b6315e8825360fba87a7a94d7846
        x-checker-data:
          type: anitya
          project-id: 9200
          stable-only: true
          url-template: https://cdn.openttd.org/opengfx-releases/$version/opengfx-$version-all.zip

  - name: openttd-openmsx
    buildsystem: simple
    build-commands:
      - tar -x -f openmsx-*.tar && rm openmsx-*.tar
      - mv openmsx-* $FLATPAK_DEST/share/games/openttd/baseset/openmsx
    sources:
      - type: archive
        url: https://cdn.openttd.org/openmsx-releases/0.4.0/openmsx-0.4.0-all.zip
        sha256: 7698cadf06c44fb5e847a5773a22a4a1ea4fc0cf45664181254656f9e1b27ee2
        x-checker-data:
          type: anitya
          project-id: 88822
          stable-only: true
          url-template: https://cdn.openttd.org/openmsx-releases/$version/openmsx-$version-all.zip

  - name: openttd-opensfx
    buildsystem: simple
    build-commands:
      - tar -x -f opensfx-*.tar && rm opensfx-*.tar
      - mv opensfx-* $FLATPAK_DEST/share/games/openttd/baseset/opensfx
    sources:
      - type: archive
        url: https://cdn.openttd.org/opensfx-releases/1.0.2/opensfx-1.0.2-all.zip
        sha256: 4814f5374eb8da0df888a4e38c3edbff3e6e3ddbb4ab13aae6933a0df3c0d333
        x-checker-data:
          type: anitya
          project-id: 88821
          stable-only: true
          url-template: https://cdn.openttd.org/opensfx-releases/$version/opensfx-$version-all.zip
